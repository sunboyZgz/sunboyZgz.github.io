---
title: rust-move-borrow
date: 2022-10-16 13:07:44
tags: newbie
category: rust
index_img: /img/rust.png
---

# ä¸€é¢˜çœ‹æ‰€æœ‰æƒé—®é¢˜

## å†™æ–‡åŸå› 

ä¼—æ‰€å‘¨çŸ¥ï¼Œåœ¨rustä¸­æ‰€æœ‰æƒé—®é¢˜æ˜¯ä¸€ä¸ªéå¸¸é‡è¦çš„é—®é¢˜ï¼Œä»–ç›´æ¥å½±å“äº†ä¸€ä¸ªç¨‹åºçš„æ€§èƒ½ã€‚å¦å¤–é…åˆä¸Šrustçš„æ£€æŸ¥å™¨+rustçš„ç”Ÿå‘½å‘¨æœŸï¼Œä»–èƒ½åœ¨å¾ˆå¤šæƒ…å†µä¸‹åŠæ—¶åé¦ˆå‡ºç¨‹åºçš„æ½œåœ¨é—®é¢˜ï¼Œè¿™ç¯‡æ–‡ç« å°†ä¼šç”¨ä¸€ä¸ªleetcodeé¢˜ç›®åˆ†æä¸€ä¸‹å¦‚ä½•åœ¨ç¼–å†™ç¨‹åºçš„æ—¶å€™è¿›è¡Œåˆç†çš„æ€è€ƒã€‚  

https://leetcode.cn/problems/merge-two-sorted-lists

**ã€æ³¨ã€‘ï¼š**æœ¬æ–‡å¹¶ä¸æ˜¯ç®—çš„è®²è§£ï¼Œæœ€å¥½åœ¨èƒ½å¤Ÿæ€è€ƒå‡ºç®—æ³•çš„å®ç°æ–¹æ¡ˆä¸‹é˜…è¯»ã€‚

## moveä¸borrow

å…³äºå˜é‡è¡¨è¾¾å¼çš„é—®é¢˜ï¼šhttps://doc.rust-lang.org/reference/expressions.html?highlight=move#place-expressions-and-value-expressions

**å…³äºè¿™é¡µç›¸å…³ç†è®ºï¼Œä¸‹é¢è¿™å¥è¯å°¤ä¸ºéœ€è¦æ³¨æ„ï¼Œè¿™å¥è¯åœ¨å¾ªç¯ä¸­èƒ½èµ·åˆ°éå¸¸å¤§çš„ä½œç”¨ã€‚**

> After moving out of a place expression that evaluates to a local variable, the location is deinitialized and cannot be read from again until it is reinitialized

å…³äºæ‰€æœ‰æƒçš„ç†è®ºåœ¨è¿™ä¸ªé“¾æ¥ä¸­æœ‰è¯¦ç»†çš„è¯´æ˜ï¼šhttps://doc.rust-lang.org/book/ch04-00-understanding-ownership.html

ä¸‹é¢æˆ‘ä»¬ç®€å•çš„è®²ä¸€ä¸‹ï¼Œæ¥ä¸‹æ¥éœ€è¦çš„ç†è®º

#### 1.æ‰€æœ‰æƒ

å¯¹äºä¸€ä¸ªä¸´æ—¶ä¸”ä¸æ˜¯referenceçš„å˜é‡æˆ‘ä»¬å¯ä»¥è®¤ä¸ºæˆ‘ä»¬æ‹¥æœ‰äº†å®ƒçš„æ‰€æœ‰æƒï¼Œæ­¤æ—¶å¯¹äºæˆ‘ä»¬å£°æ˜çš„å˜é‡æˆ‘ä»¬å¯ä»¥è®¤ä¸ºæˆ‘ä»¬æ‹¥æœ‰äº†å®ƒçš„æ‰€æœ‰æƒï¼Œå˜é‡å†…å­˜åœ°å€ä½ç½®å°±ä¼šå¼€è¾Ÿå‡ºè£…è½½è¯¥å˜é‡æ‰€éœ€è¦çš„å†…å­˜ç©ºé—´ã€‚ä¾‹å¦‚ï¼š

```rust
let node = ListNode::new(1);
```

#### 2.å¯å˜æ€§

é»˜è®¤æƒ…å†µä¸‹rustè§†ä¸ºæˆ‘ä»¬ä¸èƒ½å¯¹å˜é‡çš„å†…å­˜ç©ºé—´è¿›è¡Œæ“ä½œï¼Œå³ä½¿æ‹¥æœ‰æ‰€æœ‰æƒä¾æ—§éœ€è¦`mut`patternæ¥æä¾›å¯æ“ä½œè¯¥åŒºåŸŸå†…å­˜ç©ºé—´çš„èƒ½åŠ›ã€‚å³ä½¿ä½ æ˜¯æˆ¿å­çš„ä¸»äººï¼Œä¹Ÿéœ€è¦å…ˆç”¨é’¥åŒ™æ‰“å¼€æˆ¿å­çš„é—¨ã€‚å—¯ï¼æ²¡é”™ï¼Œå°±æ˜¯è¿™ç§æ„Ÿè§‰ã€‚

```rust
let mut node = ListNode::new(1);
node.next = Some(Box::new(ListNode::new(2)));
//ä¸‹é¢æ˜¯æ²¡æœ‰mutç¼–è¯‘å™¨çš„æŠ¥é”™
//cannot assign to `node.next`, as `node` is not declared as mutable cannot assign
```

#### 3.ä¸å¯å˜å€Ÿç”¨

å€Ÿç”¨è¿™ä¸ªæ¦‚å¿µçœŸçš„éå¸¸è´´è¿‘æˆ‘ä»¬æ—¥å¸¸çš„è¡¨è¿°äº†ï¼Œå°±æ˜¯ä¸œè¥¿æˆ‘å€Ÿç»™ä½ äº†ï¼Œä½†æ˜¯ä½ è¦åŸæ¨¡åŸæ ·å¾—è¿˜ç»™æˆ‘ã€‚

åœ¨ä»£ç ä¸­ï¼Œæˆ‘ä»¬å¯ä»¥ç†è§£ä¸ºå°†æ•°æ®å†…å­˜ç©ºé—´çš„è¯»å–èƒ½åŠ›åˆ†å‘ç»™äº†å…¶ä»–å˜é‡ã€‚

```rust
let node = ListNode::new(1);
let node2 = &node;
```

#### 4.å¯å˜å€Ÿç”¨

ä¸ä¸å¯å˜å€Ÿç”¨ç›¸ä¼¼ï¼Œæä¾›äº†å¯ä¿®æ”¹åŸæœ‰æ•°æ®å†…å­˜ç©ºé—´çš„èƒ½åŠ›ã€‚ä¸œè¥¿ä»ç„¶åœ¨æˆ‘è¿™é‡Œï¼Œä½†æ˜¯ä½ ä¿®æ”¹ä¹‹åï¼Œæˆ‘ä¹Ÿè¿™è¾¹ä¹Ÿäº§ç”Ÿäº†å˜åŒ–ã€‚

ä½†æ˜¯åœ¨è¿™ç§å€Ÿç”¨å‰ï¼Œè¿™ä¸ªä¸œè¥¿é¦–å…ˆæ˜¯èƒ½å¤Ÿä¿®æ”¹çš„ï¼Œä¹Ÿå°±æ˜¯ç»‘å®šäº†`mut` patternã€‚å¦å¤–å¯å˜å€Ÿç”¨çš„æ“ä½œç¬¦å·æ˜¯`&mut`ã€‚

è¿™ç¯‡å®˜æ–‡ä¹Ÿè¯´æ˜äº†ä½¿ç”¨å¯å˜å€Ÿç”¨çš„å…¶ä»–æ€§è´¨ï¼šhttps://doc.rust-lang.org/book/ch04-02-references-and-borrowing.html#mutable-references

```rust
let mut node = ListNode::new(1);
println!("{}", &node.val);
let node2 = &mut node;
node2.val = 2;
println("{}", node.val);
```

## å…·ä½“è¿‡ç¨‹

ä¼˜ç§€çš„ä»£ç åœ¨äº§å‡ºå‰ä¸€å®šæœ‰å¾ˆå¤šçš„æ€è€ƒï¼Œä½†æ˜¯åœ¨äº§å‡ºä¹‹å‰rustä¼šè®©ä½ å¢åŠ å¯¹äºä»£ç ç»“æ„ç¼–ç»‡çš„æ€è€ƒï¼Œä¸ç„¶ä½ å°±å¯èƒ½åªèƒ½å°†ä¼ªä»£ç ä¿å­˜åœ¨ä½ çš„è„‘å­é‡Œäº†ã€‚å¯¹äºæˆ‘ä»¬è¿™æ ·çš„æ–°æ‰‹å¦‚æœä¸è®¤çœŸæ€è€ƒçš„è¯å°±ä¸æ˜¯é¡¹ç›®è§„æ¨¡åŒ–åçš„é—®é¢˜äº†ï¼Œè€Œæ˜¯èƒ½ä¸èƒ½è®©ç¼–è¯‘å™¨çˆ¸çˆ¸æ”¾ä½ è¿‡å…³ğŸ˜‚ã€‚

#### ç®—æ³•ç®€æï¼šå¯¹äºä¸¤æ¡é“¾åˆå¹¶æƒ…å†µçš„åˆ†æ

1. ä¸¤æ¡ç©ºé“¾
2. åªæœ‰ä¸€æ¡ é“¾/å­é“¾ å­˜åœ¨
3. ä¸¤æ¡ é“¾/å­é“¾ éƒ½å­˜åœ¨

#### å°†æ€è·¯å…·ä½“åŒ–

1.åˆ›å»ºé˜²æ­¢ç¬¬ä¸€ä¸ªèŠ‚ç‚¹å°±æ˜¯NULLè€Œæ— æ³•æ­£ç¡®æ‰§è¡Œç®—æ³•çš„è¾…åŠ©èŠ‚ç‚¹

```rust
let mut head = ListNode::new(-101);
let mut cur = &mut head;					 //curå˜é‡çš„å†…å­˜åœ°å€ä¸­åº”è¯¥è¦è®°å½•å½“å‰è¿æ¥åˆ°çš„æœ€åä¸€ä¸ªèŠ‚ç‚¹ï¼Œå¦å¤–æœ€åä¸€ä¸ªç‚¹å°±æ˜¯curè®°å½•çš„æ˜¯ä¸€ä¸ªåœ°å€ï¼Œä½†æ˜¯æˆ‘ä»¬åœ¨æ‹¼æ¥æ—¶éœ€è¦ä¿®æ”¹è¿™ä¸ªåœ°å€ï¼Œè€Œä¸å•å•æ˜¯ä¿®æ”¹åœ°å€æ‰€æŒ‡çš„æ•°æ®ç©ºé—´ã€‚
...
head.next
```

2.åœ¨ä¸¤æ¡å­é“¾éƒ½å­˜åœ¨çš„æƒ…å†µä¸‹è¿›è¡Œçš„æ‹¼æ¥æ“ä½œ

While let expression:https://doc.rust-lang.org/reference/expressions/loop-expr.html#predicate-pattern-loops

Match expression: https://doc.rust-lang.org/reference/expressions/match-expr.html

> If the scrutinee expression is a [value expression](https://doc.rust-lang.org/reference/expressions.html#place-expressions-and-value-expressions), it is first evaluated into a temporary location, and the resulting value is sequentially compared to the patterns in the arms until a match is found.

é’ˆå¯¹è¿™ä¸ªé—®é¢˜æˆ‘ä»¬å¯ä»¥åšå‡ºä»¥ä¸‹ä¸¤ç§æ€è€ƒ

æ€è€ƒä¸€ï¼š

```rust
while let (Some(n1), Some(n2)) = (&list1, &list2) {//åœ¨è¿™é‡Œä½¿ç”¨å€Ÿç”¨ï¼Œè¿™æ ·ä¸ä¼šå¯¼è‡´listçš„æ‰€æœ‰æƒè½¬ç§»åˆ°è¿™é‡Œï¼Œç„¶ååé¢å°±ä¼šæ— æ³•è®¿é—®list1ï¼Œlist2
}
```

æ€è€ƒäºŒï¼š

```rust
while let (Some(n1), Some(n2)) = (list1, list2) {//è¿™å°±æ˜¯è½¬ç§»æ‰€æœ‰æƒå¹¶ä½¿ç”¨tuple patternè¿›è¡Œç»“æ„èµ‹å€¼ï¼Œè¿™æ ·n1ï¼Œn2æ‰€æœ‰æƒä¹Ÿåœ¨å½“å‰ä½œç”¨åŸŸä¸‹ã€‚ä½†æ˜¯ä½¿ç”¨è¿™ç§æ–¹æ¡ˆæˆ‘ä»¬éœ€è¦è¿›è¡Œä¸€ç‚¹ä¿®æ”¹ï¼Œå› ä¸ºè¿™æ ·çš„æ‰€æœ‰æƒè§£æ„ä¼šé€ æˆlist1ï¼Œlist2æ— æ³•åœ¨åç»­è®¿é—®
}
```

3.å–å°çš„èŠ‚ç‚¹è¿›è¡Œæ‹¼æ¥

æ€è€ƒä¸€çš„body

```rust
while let (Some(n1), Some(n2)) = (&list1, &list2) {//list1åœ¨æœªé‡åˆ†é…å‰ä¼šé£˜çº¢
	if n1.val < n2.val {
      cur.next = list1; //1.è¿™é‡Œmoveè¿›å»ï¼Œå½“æˆ‘ä»¬å†™åˆ°è¿™é‡Œåœ¨IDEç¯å¢ƒæˆ‘ä»¬ä¼šå‘ç° &list1 è¿™é‡Œå‡ºç° borrow after moveçš„é£˜çº¢æŠ¥é”™ï¼Œè¿™æ—¶è¯·ç”¨å¥½ä¸Šé¢è¯´åˆ°çš„ é‡åˆ†é…ç†è®ºï¼Œè¯·è‡ªä¿¡ä½¿ç”¨ä¸ºlist1åˆ†é…ä¸€ä¸ªæ‰€æœ‰æƒçš„valueçš„ä»£ç 
      cur = cur.next.as_mut().unwrap();  //å› ä¸ºcuræ˜¯ä¸€ä¸ªå¯å˜å€Ÿç”¨ï¼Œæ‰€ä»¥éœ€è¦ä¸€ä¸ªå¯å˜å€Ÿç”¨
      list1 = cur.next.take(); //2.ä»cur.nextè¿™é‡Œmoveå‡ºæ¥ï¼Œå¹¶æœªlist1é‡åˆ†é…
  } else {
      //ç›¸åŒé“ç†
  }
}
cur.next = if list1.is_some() { list1 } else { list2 };
```

æ€è€ƒäºŒçš„body

```rust
loop {
    if list1.is_some() && list2.is_some() {//è¿™ä¹ˆåšæ˜¯ä¸ºäº†é˜²æ­¢while letæœ€åä¸€æ¬¡è§£æ„å¼•èµ·åç»­list1ï¼Œlist2æ— æ³•borrowçš„é—®é¢˜
        let (n1, n2) = (list1.unwrap(), list2.unwrap());
        if &n1.val < &n2.val {
            cur.next = Some(n1);
            cur = cur.next.as_mut().unwrap();
            list1 = cur.next.take();
            list2 = Some(n2)
        } else {
            //ç›¸åŒé“ç†
        }
    } else {
        break;
    }
}
cur.next = if list1.is_some() { list1 } else { list2 };
```

## æ€»ç»“

åœ¨rustä»£ç çš„ç¼–å†™ä¸­æˆ‘ä»¬éœ€è¦æ›´å¤šåœ°å»æ€è€ƒï¼Œè€Œä¸æ˜¯è¿‡åº¦ä¾èµ–äºç¼–è¯‘å™¨ï¼Œè¦åšåˆ°æœ‰ç†æœ‰æ®ã€‚è¿‡åº¦ä¾èµ–ç¼–è¯‘å™¨å¾ˆå®¹æ˜“ä¸è‡ªä¿¡å•¦ã€‚
